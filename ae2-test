-- Function to get used and free item types
function getItemTypes()
    local used, max = 0, 0
    local bridge = peripheral.find("me_bridge")
    if bridge then
        local items = bridge.getItems() or {}
        used = #items
        -- AE2 hat normalerweise max. 63 Typen pro Disk, wir holen die Info Ã¼ber getCells()
        local cells = bridge.getCells() or {}
        for _, cell in pairs(cells) do
            if cell.totalBytes then
                max = max + (cell.totalBytes or 0) -- AE2 reported Types capacity
            elseif cell.capacity then
                max = max + (cell.capacity or 0) -- RS reported Types capacity
            end
        end
    end
    return used, max
end

-- Function to get used and free fluid types
function getFluidTypes()
    local used, max = 0, 0
    local bridge = peripheral.find("me_bridge")
    if bridge then
        local fluids = bridge.getFluids() or {}
        used = #fluids
        local cells = bridge.getCells() or {}
        for _, cell in pairs(cells) do
            if cell.type == "fluid" then
                max = max + (cell.totalBytes or cell.capacity or 0)
            end
        end
    end
    return used, max
end

-- Function to get used and free chemical types
function getChemicalTypes()
    local used, max = 0, 0
    local bridge = peripheral.find("me_bridge")
    if bridge then
        local chems = bridge.getChemicals() or {}
        used = #chems
        local cells = bridge.getCells() or {}
        for _, cell in pairs(cells) do
            if cell.type == "chemical" then
                max = max + (cell.totalBytes or cell.capacity or 0)
            end
        end
    end
    return used, max
end

-- Function to center text on the monitor
function centerText(monitor, text, line)
    local w, _ = monitor.getSize()
    local x = math.floor((w - #text) / 2)
    monitor.setCursorPos(x, line)
    monitor.write(text)
end

-- Main program
function updateDisplay()
    local monitor = peripheral.find("monitor")
    if not monitor then
        print("No monitor found.")
        return
    end

    monitor.setTextScale(1)
    monitor.clear()

    while true do
        monitor.clear()

        -- Items
        local usedItems, maxItems = getItemTypes()
        local freeItems = (maxItems > 0) and (maxItems - usedItems) or 0
        monitor.setTextColor(colors.yellow)
        centerText(monitor, "Item Types", 1)
        centerText(monitor, string.format("Used: %d | Free: %d", usedItems, freeItems), 2)

        -- Fluids
        local usedFluids, maxFluids = getFluidTypes()
        local freeFluids = (maxFluids > 0) and (maxFluids - usedFluids) or 0
        monitor.setTextColor(colors.cyan)
        centerText(monitor, "Fluid Types", 4)
        centerText(monitor, string.format("Used: %d | Free: %d", usedFluids, freeFluids), 5)

        -- Chemicals
        local usedChems, maxChems = getChemicalTypes()
        local freeChems = (maxChems > 0) and (maxChems - usedChems) or 0
        monitor.setTextColor(colors.purple)
        centerText(monitor, "Chemical Types", 7)
        centerText(monitor, string.format("Used: %d | Free: %d", usedChems, freeChems), 8)

        sleep(5)
    end
end

-- Start
updateDisplay()

-- Hole benutzte und freie Item Types
function getItemTypes()
    local used, max = 0, 0
    local unlimited = false
    local bridge = peripheral.find("me_bridge")
    if bridge then
        local cells = bridge.getCells() or {}
        for _, cell in pairs(cells) do
            if cell.usedBytes and cell.totalBytes then
                used = used + cell.usedBytes
                max  = max + cell.totalBytes
            elseif cell.capacity then
                unlimited = true -- RS Cells haben keine type-limitierung
            end
        end
    end
    return used, max, unlimited
end

-- Hole benutzte und freie Fluid Types
function getFluidTypes()
    local used, max = 0, 0
    local unlimited = false
    local bridge = peripheral.find("me_bridge")
    if bridge then
        local cells = bridge.getCells() or {}
        for _, cell in pairs(cells) do
            if cell.type == "fluid" then
                if cell.usedBytes and cell.totalBytes then
                    used = used + cell.usedBytes
                    max  = max + cell.totalBytes
                elseif cell.capacity then
                    unlimited = true
                end
            end
        end
    end
    return used, max, unlimited
end

-- Hole benutzte und freie Chemical Types
function getChemicalTypes()
    local used, max = 0, 0
    local unlimited = false
    local bridge = peripheral.find("me_bridge")
    if bridge then
        local cells = bridge.getCells() or {}
        for _, cell in pairs(cells) do
            if cell.type == "chemical" then
                if cell.usedBytes and cell.totalBytes then
                    used = used + cell.usedBytes
                    max  = max + cell.totalBytes
                elseif cell.capacity then
                    unlimited = true
                end
            end
        end
    end
    return used, max, unlimited
end

-- Zentriert Text auf Monitor
function centerText(monitor, text, line)
    local w, _ = monitor.getSize()
    local x = math.floor((w - #text) / 2)
    monitor.setCursorPos(x, line)
    monitor.write(text)
end

-- Hauptprogramm
function updateDisplay()
    local monitor = peripheral.find("monitor")
    if not monitor then
        print("No monitor found.")
        return
    end

    monitor.setTextScale(1)
    monitor.clear()

    while true do
        monitor.clear()

        -- Items
        local usedItems, maxItems, unlimitedItems = getItemTypes()
        monitor.setTextColor(colors.yellow)
        centerText(monitor, "Item Types", 1)
        if unlimitedItems then
            centerText(monitor, string.format("Current stored: %d Types", usedItems), 2)
            centerText(monitor, "Free: Unlimited", 3)
        else
            local freeItems = (maxItems > 0) and (maxItems - usedItems) or 0
            centerText(monitor, string.format("Current stored: %d Types", usedItems), 2)
            centerText(monitor, string.format("Free: %d Types", freeItems), 3)
        end

        -- Fluids
        local usedFluids, maxFluids, unlimitedFluids = getFluidTypes()
        monitor.setTextColor(colors.cyan)
        centerText(monitor, "Fluid Types", 5)
        if unlimitedFluids then
            centerText(monitor, string.format("Current stored: %d Types", usedFluids), 6)
            centerText(monitor, "Free: Unlimited", 7)
        else
            local freeFluids = (maxFluids > 0) and (maxFluids - usedFluids) or 0
            centerText(monitor, string.format("Current stored: %d Types", usedFluids), 6)
            centerText(monitor, string.format("Free: %d Types", freeFluids), 7)
        end

        -- Chemicals
        local usedChems, maxChems, unlimitedChems = getChemicalTypes()
        monitor.setTextColor(colors.purple)
        centerText(monitor, "Chemical Types", 9)
        if unlimitedChems then
            centerText(monitor, string.format("Current stored: %d Types", usedChems), 10)
            centerText(monitor, "Free: Unlimited", 11)
        else
            local freeChems = (maxChems > 0) and (maxChems - usedChems) or 0
            centerText(monitor, string.format("Current stored: %d Types", usedChems), 10)
            centerText(monitor, string.format("Free: %d Types", freeChems), 11)
        end

        sleep(5)
    end
end

-- Start
updateDisplay()
